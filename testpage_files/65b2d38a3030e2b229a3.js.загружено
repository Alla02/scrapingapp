(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1017:function(t,e){var r=Object.prototype.hasOwnProperty;t.exports=function(t,e){return null!=t&&r.call(t,e)}},1043:function(t,e,r){var o=r(1017),n=r(537);t.exports=function(t,e){return null!=t&&n(t,e,o)}},1044:function(t,e,r){var o=r(165),n=r(313),s=r(97);t.exports=function(t,e){var r={};return e=s(e,3),n(t,(function(t,n,s){o(r,e(t,n,s),t)})),r}},1581:function(t,e,r){},2024:function(t,e,r){"use strict";r(25),r(5);var o=r(163),n=(r(6),r(77)),s=r(11),a=r(1037),i=r(1120),l=r(166),c=r(1021),u=r(1497),p=r(107),d=r(1387),f={mixins:[a.a,c.a,i.a],props:{props:{type:Object,default:function(){return{}}}},data:function(){return{form:{code:null},locked:!1,timeLock:null,isSending:!1,codeExpiration:this.props.expiration}},methods:{sendCode:function(){var t=this;this.isSending||(this.isSending=!0,this.$axios(s.a.verifyPasswordResetCodeSmsRequest(this.preparePhone(this.props.phone),this.form.code)).then((function(e){"true"===e.data.content.success?t.$emit("input",{code:t.form.code}):t.setCodeError(e.data.content.error_data,e.data.content.success)})).catch((function(e){e instanceof l.a&&t.$refs.form.setErrors(t.prepareValidateErrors(e.data))})).finally((function(){t.isSending=!1})))},setCodeError:function(t,e){this.$refs.form.setErrors({code:[t||this.getMessageByCode("errors.wrong_code")+e]})},resendPhone:function(){var t=this;if(!this.isSending){this.isSending=!0;var e=new FormData;e.append("phone",this.preparePhone(this.props.phone)),e.append("retry",!0),this.$axios(s.a.createPasswordResetCodeSmsRequest(e)).then((function(e){e.data.content.locked?(t.locked=e.data.content.locked,t.timeLock=e.data.content.time_lock):e.data.content.expiration_date?t.codeExpiration=e.data.content.expiration_date:t.$refs.form.setErrors({code:[t.getMessageByCode("errors.".concat(e.data.content.error_code))||t.getMessageByCode("errors.server")]})})).finally((function(){t.isSending=!1}))}}},activated:function(){this.codeExpiration=this.props.expiration,this.form.code=null},components:{Timer:d.a,Banned:u.a,Loader:p.a,ValidationProvider:n.b,ValidationObserver:n.a}},m=r(2),h=Object(m.a)(f,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.locked?r("Banned",{attrs:{"unlock-date":t.timeLock}}):r("div",[r("div",{staticClass:"color-disabled-gray mb-6 tablet:mb-8 desktop1440:text-s1-r"},[t._v("\n    На ваш телефон "),r("span",{staticClass:"color-black"},[t._v(t._s(t.props.phone))]),t._v(" отправлено смс с кодом,\n    пожалуйста, введите его для подтверждения.\n  ")]),t._v(" "),r("ValidationObserver",{key:"form-code",ref:"form",scopedSlots:t._u([{key:"default",fn:function(e){var o=e.handleSubmit;return[r("form",{on:{submit:function(e){return e.preventDefault(),o(t.sendCode)}}},[r("fieldset",{staticClass:"is-full"},[r("ul",[r("li",[r("ValidationProvider",{attrs:{vid:"code",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.errors;return[r("g-form-control",{key:"code-input",attrs:{type:"text",label:"Код из смс",error:o[0],disabled:t.isSending,autocomplete:"off"},model:{value:t.form.code,callback:function(e){t.$set(t.form,"code",e)},expression:"form.code"}})]}}],null,!0)})],1)])]),t._v(" "),r("div",{staticClass:"mt-2 tablet:mt-4"},[r("button",{staticClass:"button button_primary w-full",attrs:{type:"submit"}},[t.isSending?[r("Loader",{attrs:{inline:!0,white:!0}})]:[t._v("\n            Далее\n          ")]],2)]),t._v(" "),r("div",{staticClass:"mt-5"},[r("Timer",{ref:"timer",attrs:{expirationTime:t.codeExpiration},on:{resend:t.resendPhone}})],1)])]}}])})],1)}),[],!1,null,"1fda5d6c",null).exports,b={},v=Object(m.a)(b,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("g-padding",[r("g-container",[r("div",{staticClass:"form__response py-12 tablet:py-16 desktop:py-20"},[r("h1",{staticClass:"text-x5 tablet:text-x4 mb-4"},[t._v("\n        Пароль успешно изменен\n      ")]),t._v(" "),r("div",{staticClass:"form__response-buttons mt-2 tablet:mt-4"},[r("div",{staticClass:"form__response-buttons-item"},["personal"===t.$nuxt.$router.currentRoute.name?r("button",{staticClass:"button button_primary w-full",on:{click:function(e){return t.$emit("back")}}},[r("span",{staticClass:"button__span-after"},[t._v("\n              В личный кабинет\n            ")])]):r("nuxt-link",{staticClass:"button button_primary w-full",attrs:{to:{name:"personal"}}},[r("span",{staticClass:"button__span-after"},[t._v("\n              В личный кабинет\n            ")])])],1),t._v(" "),r("div",{staticClass:"form__response-buttons-item"},[r("nuxt-link",{staticClass:"button button_secondary w-full",attrs:{to:"/"}},[r("span",{staticClass:"button__span-after"},[t._v("\n              На главную\n            ")])])],1)])])])],1)}),[],!1,null,null,null).exports,g={mixins:[a.a,c.a,i.a],props:{props:{type:Object,default:function(){return{}}}},data:function(){return{form:{phone:this.props.phone?this.props.phone:null},formText:this.props.formText?this.props.formText:"Введите номер телефона, указанный при регистрации, и мы вышлем вам код для восстановления\nпароля.",isSending:!1,codeResending:0,locked:!1,timeLock:null}},methods:{sendPhone:function(){var t=this;if(!this.isSending){this.isSending=!0;var e=this.form.phone?this.preparePhone(this.form.phone):null,r=new FormData;r.append("phone",e),this.$axios(s.a.createPasswordResetCodeSmsRequest(r)).then((function(e){e.data.content.locked?(t.locked=e.data.content.locked,t.timeLock=e.data.content.time_lock):e.data.content.expiration_date?e.data.content.time_limit?(t.codeResending=e.data.content.expiration_date,t.$refs.form.setErrors({phone:[t.getMessageByCode("errors.time_limit")]})):t.$emit("set-result",{phone:t.form.phone,expiration:e.data.content.expiration_date}):t.$refs.form.setErrors({phone:[t.getMessageByCode("errors.".concat(error.error_code))||t.getMessageByCode("errors.server")]})})).catch((function(e){e instanceof l.a&&t.$refs.form.setErrors(t.prepareValidateErrors(e.data))})).finally((function(){t.isSending=!1}))}}},components:{Timer:d.a,Banned:u.a,Loader:p.a,ValidationProvider:n.b,ValidationObserver:n.a}},_=Object(m.a)(g,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.locked?r("Banned",{attrs:{"unlock-date":t.timeLock}}):r("div",[r("div",{staticClass:"color-disabled-gray mb-6 tablet:mb-8 desktop1440:text-s1-r"},[t._v("\n    "+t._s(t.formText)+"\n  ")]),t._v(" "),r("ValidationObserver",{key:"form-phone",ref:"form",scopedSlots:t._u([{key:"default",fn:function(e){var o=e.handleSubmit;return[r("form",{on:{submit:function(e){return e.preventDefault(),o(t.sendPhone)}}},[r("fieldset",{staticClass:"is-full"},[r("ul",[r("li",[r("ValidationProvider",{attrs:{vid:"phone",rules:"required|phone"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.errors;return[r("g-form-control",{directives:[{name:"mask",rawName:"v-mask",value:"+7 (###) ###-##-##",expression:"'+7 (###) ###-##-##'"}],key:"phone-input",attrs:{type:"text",label:"Номер телефона",placeholder:"+7 (___) ___-__-__",error:o[0],disabled:t.isSending,autocomplete:"off"},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})]}}],null,!0)})],1)])]),t._v(" "),r("div",{staticClass:"mt-2 tablet:mt-4"},[r("button",{staticClass:"button button_primary w-full",attrs:{type:"submit"}},[t.isSending?[r("Loader",{attrs:{inline:!0,white:!0}})]:[r("span",{staticClass:"button__span-after"},[t._v("\n              Отправить код\n            ")])]],2)]),t._v(" "),t.props.showRestoreByEmail?r("div",{staticClass:"mt-5 text-center color-dark-gray"},[r("a",{attrs:{href:"javascript:"},on:{click:function(e){return t.$emit("toggle-method")}}},[t._v("\n          Восстановить через email\n        ")])]):t._e(),t._v(" "),t.codeResending?r("div",{staticClass:"mt-5"},[r("Timer",{ref:"timer",attrs:{expirationTime:t.codeResending,"show-resend-button":!1,"show-confirm-message":!1}})],1):t._e()])]}}])})],1)}),[],!1,null,"5ac28136",null).exports,w={mixins:[a.a,i.a],props:{},data:function(){return{form:{email:null},isSended:!1,isSending:!1,isEmailSent:!1}},methods:{onSubmit:function(){var t=this;if(!this.isSending){this.isSending=!0;var e=new FormData;e.append("email",this.form.email),this.$axios(s.a.sendResetEmailLink(e)).then((function(e){if(0===e.data.error&&e.data.content.success)t.isEmailSent=!0;else{var r=t.getMessageByCode("errors.server");e.data.content.error_data&&(r=e.data.content.error_data),t.$refs.form.setErrors({email:[r]})}})).catch((function(e){e instanceof l.a&&t.$refs.form.setErrors(t.prepareValidateErrors(e.data))})).finally((function(){t.isSending=!1}))}}},components:{Loader:p.a,ValidationProvider:n.b,ValidationObserver:n.a}},S=Object(m.a)(w,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.isEmailSent?[r("div",{staticClass:"color-disabled-gray mb-6 tablet:mb-8 desktop1440:text-s1-r"},[t._v("\n      На ваш email "),r("span",{staticClass:"color-black"},[t._v(t._s(t.form.email))]),t._v(" отправлено письмо со ссылкой\n      для восстановления доступа в личный кабинет. Если письма не видно, проверьте папку «Спам».\n    ")]),t._v(" "),r("div",{staticClass:"mt-2 tablet:mt-4"},[r("nuxt-link",{staticClass:"button button_primary w-full",attrs:{to:"/"}},[t._v("\n        Хорошо\n      ")])],1),t._v(" "),r("div",{staticClass:"mt-5 text-center color-dark-gray"},[r("a",{attrs:{href:"javascript:"},on:{click:function(e){return t.$emit("toggle-method")}}},[t._v("\n        Восстановить через номер телефона\n      ")])])]:[r("div",{staticClass:"color-disabled-gray mb-6 tablet:mb-8 desktop1440:text-s1-r"},[t._v("\n      Введите email, указанный при регистрации, и мы вышлем вам письмо для восстановления пароля.\n    ")]),t._v(" "),t.isSended?t._e():r("ValidationObserver",{ref:"form",scopedSlots:t._u([{key:"default",fn:function(e){var o=e.handleSubmit;return[r("form",{on:{submit:function(e){return e.preventDefault(),o(t.onSubmit)}}},[r("fieldset",{staticClass:"is-full"},[r("ul",[r("li",[r("ValidationProvider",{attrs:{vid:"email",rules:"required|email"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.errors;return[r("g-form-control",{attrs:{type:"text",label:"Email",error:o[0],autocomplete:"off",isExternalError:!0},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})]}}],null,!0)})],1)])]),t._v(" "),r("div",{staticClass:"mt-2 tablet:mt-4"},[r("button",{staticClass:"button button_primary w-full",attrs:{type:"submit"}},[t._v("\n            Отправить письмо\n          ")])]),t._v(" "),r("div",{staticClass:"mt-5 text-center color-dark-gray"},[r("a",{attrs:{href:"javascript:"},on:{click:function(e){return t.$emit("toggle-method")}}},[t._v("\n            Восстановить через номер телефона\n          ")])])])]}}],null,!1,258434953)})]],2)}),[],!1,null,"10c807f8",null).exports,y={props:{props:{type:Object,default:function(){return{}}}},data:function(){return{byPhone:!0}},methods:{toggleMethod:function(){this.byPhone=!this.byPhone},setResult:function(t){this.$emit("input",t)}},components:{FormRestorePasswordPhone:_,FormRestorePasswordEmail:S}},k=Object(m.a)(y,(function(){var t=this.$createElement,e=this._self._c||t;return this.byPhone?e("FormRestorePasswordPhone",{attrs:{props:this.props},on:{"toggle-method":this.toggleMethod,"set-result":this.setResult}}):e("FormRestorePasswordEmail",{on:{"toggle-method":this.toggleMethod}})}),[],!1,null,"7c40b014",null).exports,x=(r(7),r(3),r(60),r(9),r(10),r(8),r(15)),C=r(18),P=r(21),$={props:{},data:function(){return{form:{password:null,passwordConfirm:null,remember:null}}},methods:{onSubmit:function(){this.$emit("on-submit",{password:this.form.password,passwordConfirm:this.form.passwordConfirm})},setErrors:function(t){this.$refs.form.setErrors(t)},togglePassword:function(t){"password-input"===t?this.$refs["password-input-confirm"].togglePassword():this.$refs["password-input"].togglePassword()}},components:{ValidationProvider:n.b,ValidationObserver:n.a}},E=Object(m.a)($,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("ValidationObserver",{ref:"form",scopedSlots:t._u([{key:"default",fn:function(e){var o=e.handleSubmit;return[r("form",{on:{submit:function(e){return e.preventDefault(),o(t.onSubmit)}}},[r("fieldset",{staticClass:"is-full"},[r("ul",[r("li",[r("ValidationProvider",{attrs:{vid:"password",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.errors;return[r("g-form-control",{ref:"password-input",attrs:{id:"password-input",type:"password",label:"Пароль",error:o[0],autocomplete:"off"},on:{"toggle-password":t.togglePassword},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})]}}],null,!0)})],1),t._v(" "),r("li",[r("ValidationProvider",{attrs:{vid:"passwordConfirm",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.errors;return[r("g-form-control",{ref:"password-input-confirm",attrs:{id:"password-input-confirm",type:"password",label:"Повторите пароль",error:o[0],autocomplete:"off"},on:{"toggle-password":t.togglePassword},model:{value:t.form.passwordConfirm,callback:function(e){t.$set(t.form,"passwordConfirm",e)},expression:"form.passwordConfirm"}})]}}],null,!0)})],1)])]),t._v(" "),r("div",{staticClass:"mt-2 tablet:mt-4"},[r("button",{staticClass:"button button_primary",attrs:{type:"submit"}},[t._v("Продолжить")])])])]}}])})],1)}),[],!1,null,"949fad0a",null).exports;function O(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function B(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?O(Object(r),!0).forEach((function(e){Object(x.a)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var R={mixins:[a.a,P.a,c.a,i.a],props:{props:{type:Object,default:function(){return{}}}},data:function(){return{isSending:!1}},computed:B({},Object(C.e)("personal/personal",["isAuthPopup"]),{passwordRules:function(){return this.getMessageByCode("password.title")},isRestoreByEmail:function(){return Boolean(this.props.token)}}),methods:{onSubmit:function(t){var e=this;if(!this.isSending){this.isSending=!0;var r=new FormData;r.append("password",t.password),r.append("password_confirmation",t.passwordConfirm);var o=null;this.isRestoreByEmail?(r.append("token",this.props.token),r.append("email",this.props.email),o=this.$axios(s.a.updatePasswordByEmail(r))):(r.append("code",this.props.code),r.append("phone",this.preparePhone(this.props.phone)),o=this.$axios(s.a.updatePassword(r))),o.then((function(r){if(r.data.content.success)if(e.isRestoreByEmail)e.$emit("input");else{var o=new FormData;o.append("username",e.preparePhone(e.props.phone)),o.append("password",t.password);var n=B({},e.$auth.options.redirect);e.isAuthPopup&&(e.$auth.options.redirect.home=!1),e.$auth.loginWith("local",{data:o}).then((function(){e.gtagEventByType("","login"),e.isAuthPopup?(e.$auth.options.redirect=B({},n),e.$emit("restored"),e.$router.push(e.$route.path.slice(0,-1))):e.$auth.$storage.setState("fromRestore",!0)})).catch((function(){e.$emit("input")}))}else{var s=e.getMessageByCode("errors.server");r.data.content.error_data&&(s=r.data.content.error_data),e.$refs.passwordForm.setErrors({password:[s]})}})).catch((function(t){t instanceof l.a&&e.$refs.passwordForm.setErrors(e.prepareValidateErrors(t.data))})).finally((function(){e.isSending=!1}))}}},components:{FormSetPassword:E}},j=Object(m.a)(R,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"color-disabled-gray mb-6 tablet:mb-8 desktop1440:text-s1-r",domProps:{innerHTML:this._s(this.passwordRules)}}),this._v(" "),e("FormSetPassword",{ref:"passwordForm",attrs:{props:this.props,isSending:this.isSending},on:{"on-submit":this.onSubmit}})],1)}),[],!1,null,null,null).exports,T=r(78),V=r.n(T),F=r(98),L=r.n(F),M={props:{steps:{type:Array,default:[]},showBackButton:{type:Boolean,default:!0},showBackButtonOnStart:{type:Boolean,default:!0},token:{type:String,default:null},email:{type:String,default:null},phone:{type:String,default:null},showRestoreByEmail:{type:Boolean,default:!0},formText:{type:String,default:null},fromPersonal:{type:Boolean,default:!1}},data:function(){return{currentStepIndex:0,result:{code:null,phone:null,expiration:null},allSteps:{confirm:{name:this.fromPersonal?"Вход в личный кабинет":"Восстановление пароля",component:k,showTitle:!0,showBreadcrumbs:!0},code:{name:this.fromPersonal?"Вход в личный кабинет":"Восстановление пароля",component:h,showTitle:!0,showBreadcrumbs:!0},password:{name:"Придумайте пароль",component:j,showTitle:!0,showBreadcrumbs:!0},final:{name:"Пароль успешно изменен",component:v,showTitle:!1,showBreadcrumbs:!1}}}},created:function(){this.setOptions()},computed:{currentStep:{get:function(){return this.keySteps[this.currentStepIndex]},set:function(t){this.selectStep(L()(this.keySteps,t))}},keySteps:function(){return V()(this.currentSteps)},currentSteps:function(){var t=this,e={};return this.steps.forEach((function(r){e[r]={code:r,name:t.allSteps[r].name,component:t.allSteps[r].component,showTitle:t.allSteps[r].showTitle,showBreadcrumbs:t.allSteps[r].showBreadcrumbs}})),e},currentStepOptions:function(){return this.currentSteps[this.currentStep]},currentStepProps:function(){switch(this.currentStep){case"confirm":return this.getConfirmStepProps();case"code":return this.getCodeStepProps();case"password":return this.getPasswordStepProps();default:return{}}},showBackButtonOnFirstStep:function(){return this.showBackButtonOnStart&&0===this.currentStepIndex}},methods:{toggleMethod:function(){this.byPhone=!this.byPhone},nextStep:function(){this.currentStepIndex++},setResult:function(t){switch(this.currentStep){case"confirm":this.result.phone=t.phone,this.result.expiration=t.expiration,this.nextStep();break;case"code":this.result.code=t.code,this.nextStep();break;case"password":this.nextStep()}},onBackButtonClick:function(){"confirm"!==this.currentStep?this.currentStepIndex=0:this.onBackClick()},onBackClick:function(){this.$emit("back")},getConfirmStepProps:function(){return{phone:this.phone,formText:this.formText,showRestoreByEmail:this.showRestoreByEmail}},getCodeStepProps:function(){return{phone:this.result.phone,expiration:this.result.expiration}},getPasswordStepProps:function(){return{token:this.token,email:this.email,code:this.result.code,phone:this.result.phone,expiration:this.result.expiration}},setOptions:function(){var t;t={showTabs:!1,showBackButton:!0,formTitles:{title:this.currentStepOptions.name}},this.$emit("set-options",t)},restored:function(){this.$emit("restored")}},watch:{currentStepIndex:function(){this.setOptions()}},components:{StepCode:h,StepFinal:v,StepConfirm:k,StepPassword:j,IconTickLeft:o.a}},D=(r(2078),Object(m.a)(M,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("keep-alive",[r(t.currentStepOptions.component,{tag:"component",attrs:{props:t.currentStepProps},on:{input:t.setResult,restored:t.restored,back:t.onBackClick,"close-popup":function(e){return t.$emit("close-popup")}}})],1)}),[],!1,null,"7ebec48b",null));e.a=D.exports},2078:function(t,e,r){"use strict";var o=r(1581);r.n(o).a}}]);